<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ECHO.WATCH</title>
  <script src="https://unpkg.com/maplibre-gl@4.1.0/dist/maplibre-gl.js"></script>
  <link href="https://unpkg.com/maplibre-gl@4.1.0/dist/maplibre-gl.css" rel="stylesheet" />
  <link href="https://unpkg.com/@maplibre/maplibre-gl-compare@0.4.0/dist/maplibre-gl-compare.css" rel="stylesheet" />
  <script src="https://unpkg.com/@maplibre/maplibre-gl-compare@0.4.0/dist/maplibre-gl-compare.js"></script>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
    </button>
    <div class="logo">
      <div class="logo-mark">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7zm0 12c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>
      </div>
      <span class="logo-text">ECHO.WATCH</span>
    </div>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Search any location..." autocomplete="off">
      <div class="search-results" id="searchResults"></div>
    </div>
    <div class="header-controls">
      <div class="date-control" id="dateControl">
        <label>Date:</label>
        <input type="date" id="dateSelect">
        <button class="compare-toggle" id="compareToggle">+ Compare</button>
      </div>
      <div class="date-control compare-dates" id="compareDates">
        <label>Before:</label>
        <input type="date" id="beforeDate">
        <label>After:</label>
        <input type="date" id="afterDate">
        <button class="compare-close" id="compareClose">√ó</button>
        <div class="compare-type-toggle">
          <button class="compare-type-btn active" data-type="swipe">Swipe</button>
          <button class="compare-type-btn" data-type="side-by-side">Split</button>
        </div>
      </div>
      <div class="layer-toggle">
        <button class="layer-btn active" data-layer="nightlights">Night Lights</button>
        <button class="layer-btn" data-layer="blackmarble">Black Marble</button>
      </div>
      <button class="export-btn" id="exportBtn">Export</button>
    </div>
  </header>

  <div class="export-modal" id="exportModal">
    <div class="export-content">
      <div class="export-header">
        <h3>Export View</h3>
        <button class="export-close" id="exportClose">√ó</button>
      </div>
      <div class="export-body">
        <div class="export-section">
          <label>Shareable Link</label>
          <div class="export-link-row">
            <input type="text" id="exportUrl" readonly>
            <button class="copy-btn" id="copyUrl">Copy</button>
          </div>
        </div>
        <div class="export-section">
          <label>Metadata</label>
          <div class="export-meta" id="exportMeta">
            <div class="meta-row"><span>Location</span><span id="metaLocation">--</span></div>
            <div class="meta-row"><span>Coordinates</span><span id="metaCoords">--</span></div>
            <div class="meta-row"><span>Date</span><span id="metaDate">--</span></div>
            <div class="meta-row"><span>Zoom</span><span id="metaZoom">--</span></div>
          </div>
        </div>
        <div class="export-section">
          <label>Screenshot</label>
          <button class="download-btn" id="downloadScreenshot">Download PNG</button>
        </div>
      </div>
    </div>
  </div>

  <div class="loading-indicator" id="loading">Loading satellite imagery...</div>

  <!-- Welcome Modal -->
  <div class="welcome-modal" id="welcomeModal">
    <div class="welcome-content">
      <div class="welcome-header">
        <div class="welcome-logo">
          <div class="welcome-icon">
            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7zm0 12c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>
          </div>
          <span>ECHO.WATCH</span>
        </div>
        <button class="welcome-close" id="welcomeClose">&times;</button>
      </div>
      <div class="welcome-body">
        <h1>Nighttime satellite imagery</h1>
        <p class="welcome-tagline">NASA VIIRS Day/Night Band data. Updated daily. Global coverage since 2012.</p>

        <div class="welcome-features">
          <div class="welcome-feature">
            <div class="feature-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></svg>
            </div>
            <div class="feature-text">
              <strong>750m resolution</strong>
              <span>Visible light captured nightly by polar-orbiting satellite</span>
            </div>
          </div>
          <div class="welcome-feature">
            <div class="feature-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
            </div>
            <div class="feature-text">
              <strong>Radiance measurement</strong>
              <span>Quantified brightness in nW/cm¬≤/sr</span>
            </div>
          </div>
          <div class="welcome-feature">
            <div class="feature-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M12 3v18M3 12h18"/></svg>
            </div>
            <div class="feature-text">
              <strong>Temporal comparison</strong>
              <span>Compare any two dates since 2012</span>
            </div>
          </div>
        </div>

        <div class="welcome-cta">
          <button class="welcome-tour" id="welcomeTour">View example: Hurricane Maria 2017</button>
          <button class="welcome-start" id="welcomeStart">Continue</button>
          <label class="welcome-remember">
            <input type="checkbox" id="welcomeDontShow">
            <span>Don't show again</span>
          </label>
        </div>
      </div>
      <div class="welcome-footer">
        <span>Data: NASA GIBS</span>
        <span>ECHOCORP</span>
      </div>
    </div>
  </div>

  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <main>
    <div id="map-wrapper">
      <div id="map"></div>
      <div id="map-after"></div>
      <div class="date-label before" id="labelBefore">BEFORE</div>
      <div class="date-label after" id="labelAfter">AFTER</div>
    </div>
    <aside class="sidebar">
      <!-- Reference -->
      <div class="guide-card" id="guideCard">
        <div class="guide-header">
          <div class="guide-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
            <span>Reference</span>
          </div>
          <button class="guide-toggle" id="guideToggle">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 9l-7 7-7-7"/></svg>
          </button>
        </div>
        <div class="guide-content" id="guideContent">
          <p>VIIRS Day/Night Band imagery. Bright pixels indicate sources of visible light: electric lighting, gas flares, fires, fishing vessels.</p>

          <div class="guide-legend">
            <div class="legend-title">Radiance scale</div>
            <div class="legend-items">
              <div class="legend-item">
                <span class="legend-color" style="background: #ffffff;"></span>
                <span>High radiance ‚Äî urban cores, industrial sites</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #fcd34d;"></span>
                <span>Medium ‚Äî suburban areas, lit highways</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #f97316;"></span>
                <span>Low ‚Äî rural settlements, isolated structures</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background: #1e1e1e; border: 1px solid #333;"></span>
                <span>Below threshold ‚Äî no detected light sources</span>
              </div>
            </div>
          </div>

          <div class="guide-tips">
            <div class="tip-title">Interpretation notes:</div>
            <ul>
              <li><strong>Decrease</strong> ‚Äî power loss, infrastructure damage, evacuation</li>
              <li><strong>Increase</strong> ‚Äî development, reconstruction, temporary events</li>
              <li><strong>Linear features</strong> ‚Äî transportation corridors, borders</li>
              <li><strong>Offshore points</strong> ‚Äî fishing fleets, oil platforms</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="anomaly-panel" id="anomalyPanel">
        <div class="anomaly-header">
          <h3>Brightness Anomaly</h3>
          <span class="anomaly-badge" id="anomalyBadge">--</span>
        </div>
        <div class="anomaly-value" id="anomalyValue">
          <span class="anomaly-percent">--</span>
          <span class="anomaly-direction">vs. baseline</span>
        </div>
        <div class="anomaly-details" id="anomalyDetails">
          <div class="anomaly-row">
            <span class="label">Current</span>
            <span class="value" id="anomalyCurrent">--</span>
          </div>
          <div class="anomaly-row">
            <span class="label">Baseline</span>
            <span class="value" id="anomalyBaseline">--</span>
          </div>
          <div class="anomaly-row">
            <span class="label">Reference</span>
            <span class="value" id="anomalyReference">--</span>
          </div>
        </div>
        <div class="anomaly-context" id="anomalyContext">
          <div class="context-interpretation" id="contextInterpretation"></div>
          <div class="context-scale" id="contextScale">
            <div class="scale-bar">
              <div class="scale-marker" id="scaleMarker"></div>
            </div>
            <div class="scale-labels">
              <span>-50%</span>
              <span>Normal</span>
              <span>+50%</span>
            </div>
          </div>
          <div class="context-cause" id="contextCause"></div>
          <div class="context-news" id="contextNews">
            <a href="#" id="newsLink" target="_blank" class="news-link">
              <span class="news-icon">üì∞</span>
              Search related news
            </a>
          </div>
        </div>
        <p class="anomaly-note" id="anomalyNote">Select a location to analyze brightness patterns</p>
      </div>

      <!-- Random Location -->
      <div class="discover-section">
        <button class="discover-btn" id="discoverBtn">
          <span class="discover-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/>
            </svg>
          </span>
          <span class="discover-text">
            <strong>Random location</strong>
            <span>View a curated point of interest</span>
          </span>
        </button>
      </div>

      <!-- Location Info Card -->
      <div class="discover-card hidden" id="discoverCard">
        <div class="discover-card-header">
          <span class="discover-label">Location</span>
          <button class="discover-close" id="discoverClose">&times;</button>
        </div>
        <h3 id="discoverLocation">--</h3>
        <p id="discoverFact">--</p>
        <div class="discover-lookfor">
          <strong>Observable features:</strong>
          <p id="discoverLookFor">--</p>
        </div>
        <button class="discover-another" id="discoverAnother">Next location</button>
      </div>

      <!-- Historical Events -->
      <div class="info-block events-block">
        <h3>Historical events</h3>
        <p class="events-intro">Documented incidents with significant light output changes. Click to load before/after comparison.</p>
        <div class="events-list" id="eventsList">
          <!-- Populated by JS -->
        </div>
      </div>

      <div class="info-block">
        <h3>Monitored locations</h3>
        <div class="location-list" id="locationList">
          <!-- Populated by JS -->
        </div>
      </div>

      <div class="info-block">
        <h3>Methodology</h3>
        <p>VIIRS (Visible Infrared Imaging Radiometer Suite) orbits at 824km altitude, completing 14 orbits daily. The Day/Night Band sensor detects visible and near-infrared light.</p>
        <p>Brightness values are compared against historical baselines to calculate percentage variance.</p>
      </div>

      <div class="info-block">
        <h3>Specifications</h3>
        <ul class="data-notes">
          <li>Update frequency: daily (24-48hr latency)</li>
          <li>Spatial resolution: 750m</li>
          <li>Radiometric range: 3√ó10‚Åª‚Åπ to 0.02 W/cm¬≤/sr</li>
          <li>Coverage: global, since April 2012</li>
        </ul>
      </div>

      <div class="data-source">
        Data: <a href="https://earthdata.nasa.gov/topics/human-dimensions/nighttime-lights" target="_blank">NASA VIIRS DNB</a> via GIBS<br>
        Part of <a href="https://echocorp.xyz">ECHOCORP</a>
      </div>
    </aside>
  </main>

  <div class="status-bar">
    <span id="locationInfo">Hover over map for coordinates</span>
    <span class="coords" id="coords"></span>
  </div>

  <script src="js/app.js"></script>
</body>
</html>
